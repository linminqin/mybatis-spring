<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 公共 -->
<mapper namespace="common">

    <!-- 删除 -->
    <update id="executeUpdate" parameterType="string">
   		${sql}
    </update>
    
    <!-- 删除 -->
    <delete id="executeDelete" parameterType="string">
    	delete from ${tableName} 
    	<where>
    		<include refid="common.propertiesCondition"/>
    	</where>
    </delete>
    
    <!-- 根据ID批量删除 -->
    <delete id="executeBatchDeleteByIds">
    	delete from ${tableName}
    	<if test="ids != null and ids.length > 0">
    		where id in
	    	<foreach collection="ids" index="index" item="item" open="(" separator="," close=")"> 
		       	#{item} 
		    </foreach> 
	    </if>
    </delete>
    
    <!-- 过滤条件 -->
    <sql id="propertiesCondition">
        <foreach collection="filters" item="filter" separator="and">
				<choose>
					<when test="filter.compareType.value == 'eq'">
						${filter.propertyName} = #{filter.propertyValue}
					</when>
					<when test="filter.compareType.value == 'ne'">
						${filter.propertyName} != #{filter.propertyValue}
					</when>
					<when test="filter.compareType.value == 'gt'">
						${filter.propertyName} > #{filter.propertyValue}
					</when>
					<when test="filter.compareType.value == 'ge'">
						${filter.propertyName} >= #{filter.propertyValue}
					</when>
					<when test="filter.compareType.value == 'lt'">
						<![CDATA[ ${filter.propertyName} < #{filter.propertyValue} ]]>
					</when>
					<when test="filter.compareType.value == 'le'">
						<![CDATA[ ${filter.propertyName} <= #{filter.propertyValue} ]]>
					</when>
					<when test="filter.compareType.value == 'like'">
						${filter.propertyName} like '%${filter.propertyValue}%'
					</when>
					<when test="filter.compareType.value == 'llike'">
						${filter.propertyName} like '${filter.propertyValue}%'
					</when>
					<when test="filter.compareType.value == 'rlike'">
						${filter.propertyName} like '%${filter.propertyValue}'
					</when>
					<when test="filter.compareType.value == 'nlike'">
						${filter.propertyName} not like '${filter.propertyValue}%'
					</when>
					<when test="filter.compareType.value == 'nllike'">
						${filter.propertyName} not like '${filter.propertyValue}%'
					</when>
					<when test="filter.compareType.value == 'nrlike'">
						${filter.propertyName} not like '%${filter.propertyValue}'
					</when>
					<when test="filter.compareType.value == 'nnull'">
						${filter.propertyName} is not null
					</when>
					<when test="filter.compareType.value == 'null'">
						${filter.propertyName} is null
					</when>
					<otherwise>
						${filter.propertyName} = #{filter.propertyValue}
					</otherwise>
				</choose>
			</foreach>
    </sql>
    
</mapper>